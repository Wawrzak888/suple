<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta id="theme-color-meta" name="theme-color" content="#FDFBF7">
    <title>VITA-KOD 3.2</title>

    <!-- Web Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"VITA-KOD 3.2","short_name":"VITA-KOD","display":"standalone","background_color":"#FDFBF7","theme_color":"#7F5539","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/3004/3004451.png","sizes":"512x512","type":"image/png"}]}'>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Light Mode Colors */
            --bg-color: #FDFBF7;
            --card-bg: #FFFFFF;
            --primary-brown: #7F5539;
            --secondary-brown: #B08968;
            --light-cream: #EDE0D4;
            --text-dark: #432818;
            --text-light: #8C7B70;
            --white: #FFFFFF;
            --safe-top: env(safe-area-inset-top);
            --shadow: rgba(127, 85, 57, 0.08);
        }

        /* Dark Mode Colors override */
        body.dark-mode {
            --bg-color: #1A1A1A;
            --card-bg: #2C2C2C;
            --primary-brown: #D7CCC8;
            --secondary-brown: #A1887F;
            --light-cream: #3E2723;
            --text-dark: #F5F5F5;
            --text-light: #BDBDBD;
            --white: #2C2C2C;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: calc(var(--safe-top) + 20px) 20px 100px;
            min-height: 100vh;
            line-height: 1.5;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* NagÅ‚Ã³wek i PostÄ™p */
        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 700;
            color: var(--primary-brown);
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .progress-wrapper {
            background: var(--light-cream);
            border-radius: 12px;
            height: 10px;
            width: 100%;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }

        #progress-fill {
            height: 100%;
            background: var(--primary-brown);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* UkÅ‚ad sekcji */
        .time-section {
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--secondary-brown);
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 1px;
        }

        .cards-container {
            display: grid;
            gap: 12px;
        }

        /* Styl karty */
        .supp-card {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 18px;
            box-shadow: 0 4px 15px var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
        }

        .supp-card.checked {
            background: var(--light-cream);
            border-color: var(--secondary-brown);
            opacity: 0.8;
        }

        .supp-info {
            flex: 1;
        }

        .supp-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 2px;
        }

        .supp-hint {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Niestandardowy Checkbox */
        .checkbox-custom {
            width: 26px;
            height: 26px;
            border: 2px solid var(--secondary-brown);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .checked .checkbox-custom {
            background: var(--secondary-brown);
        }

        .checkbox-custom::after {
            content: 'âœ“';
            color: var(--white);
            font-weight: bold;
            display: none;
        }

        .checked .checkbox-custom::after {
            display: block;
        }

        /* Style przyciskÃ³w */
        .btn-icon {
            background: var(--light-cream);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-brown);
        }

        .btn-edit-toggle {
            background: var(--light-cream);
            border: none;
            padding: 0 16px;
            height: 40px;
            border-radius: 12px;
            font-family: inherit;
            font-weight: 600;
            color: var(--primary-brown);
            cursor: pointer;
        }

        .delete-btn {
            display: none;
            background: #ef5350;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 10px;
            cursor: pointer;
        }

        .edit-mode .delete-btn { display: flex; }
        .edit-mode .checkbox-custom { display: none; }

        .add-btn {
            background: transparent;
            border: 2px dashed var(--secondary-brown);
            color: var(--secondary-brown);
            padding: 12px;
            border-radius: 18px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            display: none;
        }

        .edit-mode .add-btn { display: block; }

        /* Modal */
        #modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal {
            background: var(--bg-color);
            padding: 24px;
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        input, select {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: 2px solid var(--light-cream);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text-dark);
            font-family: inherit;
        }

        .btn-main {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            font-weight: 600; cursor: pointer;
        }
        .btn-save { background: var(--primary-brown); color: var(--bg-color); }
        .btn-cancel { background: var(--light-cream); color: var(--text-dark); }

        footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 40px;
        }
    </style>
</head>
<body class="dark-mode"> <!-- DomyÅ›lnie ciemny, zmieni siÄ™ w JS jeÅ›li trzeba -->

<header>
    <div id="date-label">
        <h1>VITA-KOD 3.2</h1>
        <div id="today-date" style="font-size: 14px; color: var(--text-light)"></div>
    </div>
    <div class="header-actions">
        <button class="btn-icon" onclick="toggleTheme()" id="theme-icon">ðŸŒ™</button>
        <button class="btn-edit-toggle" onclick="toggleEditMode()" id="edit-btn">Edytuj</button>
    </div>
</header>

<div class="progress-wrapper">
    <div id="progress-fill"></div>
</div>

<div id="app-content">
    <!-- Kontent -->
</div>

<div id="modal-overlay">
    <div class="modal">
        <h2 style="margin-top:0">Dodaj suplement</h2>
        <input type="text" id="new-name" placeholder="Nazwa (np. Magnez)">
        <input type="text" id="new-hint" placeholder="Notatka (np. po jedzeniu)">
        <select id="new-time">
            <option value="Na czczo">Na czczo</option>
            <option value="Åšniadanie">Åšniadanie</option>
            <option value="PoÅ‚udnie">PoÅ‚udnie</option>
            <option value="Obiad">Obiad</option>
            <option value="Przed snem">Przed snem</option>
        </select>
        <div style="display:flex; gap:10px; margin-top:15px">
            <button class="btn-main btn-cancel" onclick="closeModal()">Anuluj</button>
            <button class="btn-main btn-save" onclick="saveItem()">Zapisz</button>
        </div>
    </div>
</div>

<footer>
    Koncepcja: Tomasz Wawrzak | VITA-KOD System
</footer>

<script>
    const STORAGE_KEY_LIST = 'vitakod_list_v3';
    const STORAGE_KEY_STATE = 'vitakod_state_v3';
    const STORAGE_KEY_DATE = 'vitakod_last_date_v3';
    const STORAGE_KEY_THEME = 'vitakod_theme_pref';

    let supplements = [
        { id: '1', time: 'Na czczo', name: 'BPC-157 + KPV', hint: '30 min przed jedzeniem' },
        { id: '2', time: 'Åšniadanie', name: 'B-Complex + NAC', hint: '' },
        { id: '3', time: 'Åšniadanie', name: 'Diosmina + Hesperydyna', hint: '' },
        { id: '4', time: 'Åšniadanie', name: 'Kreatyna', hint: '3-5g' },
        { id: '5', time: 'PoÅ‚udnie', name: 'BÅ‚onnik', hint: '2h odstÄ™pu, duÅ¼o wody' },
        { id: '6', time: 'Obiad', name: 'WapÅ„ + D3 + K2 + Kolagen', hint: 'Wymaga tÅ‚uszczu' },
        { id: '7', time: 'Obiad', name: 'Omega-3 + Chrom', hint: '' },
        { id: '8', time: 'Przed snem', name: 'Lit + Bor + Magnez', hint: '' },
        { id: '9', time: 'Przed snem', name: 'Glicyna', hint: 'NapÃ³j' }
    ];

    let checkedIds = [];
    let isEditMode = false;

    function init() {
        // Theme init
        const savedTheme = localStorage.getItem(STORAGE_KEY_THEME);
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'light') {
            document.body.classList.remove('dark-mode');
            document.getElementById('theme-icon').innerText = 'â˜€ï¸';
        } else if (savedTheme === 'dark' || prefersDark) {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-icon').innerText = 'ðŸŒ™';
        }

        // Data init
        const savedList = localStorage.getItem(STORAGE_KEY_LIST);
        if (savedList) supplements = JSON.parse(savedList);

        const today = new Date().toLocaleDateString('pl-PL');
        const lastDate = localStorage.getItem(STORAGE_KEY_DATE);
        
        if (lastDate !== today) {
            checkedIds = [];
            localStorage.setItem(STORAGE_KEY_DATE, today);
            localStorage.setItem(STORAGE_KEY_STATE, JSON.stringify([]));
        } else {
            const savedState = localStorage.getItem(STORAGE_KEY_STATE);
            if (savedState) checkedIds = JSON.parse(savedState);
        }

        document.getElementById('today-date').innerText = today;
        render();
    }

    function toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem(STORAGE_KEY_THEME, isDark ? 'dark' : 'light');
        document.getElementById('theme-icon').innerText = isDark ? 'ðŸŒ™' : 'â˜€ï¸';
        
        // Update browser theme color
        document.getElementById('theme-color-meta').setAttribute('content', isDark ? '#1A1A1A' : '#FDFBF7');
    }

    function render() {
        const content = document.getElementById('app-content');
        content.innerHTML = '';
        const times = ['Na czczo', 'Åšniadanie', 'PoÅ‚udnie', 'Obiad', 'Przed snem'];
        
        times.forEach(time => {
            const section = document.createElement('div');
            section.className = 'time-section';
            const group = supplements.filter(s => s.time === time);
            
            let itemsHtml = group.map(item => {
                const isChecked = checkedIds.includes(item.id);
                return `
                    <div class="supp-card ${isChecked ? 'checked' : ''}" onclick="toggleCheck('${item.id}')">
                        <div class="supp-info">
                            <div class="supp-name">${item.name}</div>
                            <div class="supp-hint">${item.hint}</div>
                        </div>
                        <div class="checkbox-custom"></div>
                        <button class="delete-btn" onclick="deleteItem(event, '${item.id}')">âœ•</button>
                    </div>
                `;
            }).join('');

            section.innerHTML = `
                <div class="section-header">${time}</div>
                <div class="cards-container">
                    ${itemsHtml}
                    <div class="add-btn" onclick="openModal('${time}')">+ Dodaj do tej pory</div>
                </div>
            `;
            content.appendChild(section);
        });

        updateProgress();
        document.body.classList.toggle('edit-mode', isEditMode);
    }

    function toggleCheck(id) {
        if (isEditMode) return;
        const index = checkedIds.indexOf(id);
        if (index === -1) checkedIds.push(id);
        else checkedIds.splice(index, 1);
        localStorage.setItem(STORAGE_KEY_STATE, JSON.stringify(checkedIds));
        render();
    }

    function updateProgress() {
        const total = supplements.length;
        const done = checkedIds.filter(id => supplements.some(s => s.id === id)).length;
        const percent = total === 0 ? 0 : Math.round((done / total) * 100);
        document.getElementById('progress-fill').style.width = percent + '%';
    }

    function toggleEditMode() {
        isEditMode = !isEditMode;
        document.getElementById('edit-btn').innerText = isEditMode ? 'Gotowe' : 'Edytuj';
        render();
    }

    function openModal(time) {
        document.getElementById('new-time').value = time;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
        document.getElementById('new-name').value = '';
        document.getElementById('new-hint').value = '';
    }

    function saveItem() {
        const name = document.getElementById('new-name').value.trim();
        const hint = document.getElementById('new-hint').value.trim();
        const time = document.getElementById('new-time').value;
        if (!name) return;

        const newItem = { id: Date.now().toString(), name, hint, time };
        supplements.push(newItem);
        localStorage.setItem(STORAGE_KEY_LIST, JSON.stringify(supplements));
        closeModal();
        render();
    }

    function deleteItem(event, id) {
        event.stopPropagation();
        supplements = supplements.filter(s => s.id !== id);
        checkedIds = checkedIds.filter(cid => cid !== id);
        localStorage.setItem(STORAGE_KEY_LIST, JSON.stringify(supplements));
        localStorage.setItem(STORAGE_KEY_STATE, JSON.stringify(checkedIds));
        render();
    }

    init();
</script>

</body>
</html>